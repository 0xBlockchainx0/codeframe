<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>./static/js/main.js annotated source</title>
    <link rel="stylesheet" href="/codeframe/main.css">
</head>

<body>
    <main>
        <div class="line">
            <div class="doc">
                <h1>./static/js/main.js <span class="fade">annotated source</span></h1>
                <em><a class="back" href="/codeframe/">Back to index</a></em>
            </div>
            <pre></pre>
        </div>
        <div class="line"><div class="doc"><h2 id="codeframes-editor-component">Codeframe&#39;s editor component</h2>
</div><pre class="source javascript"><strong class="lineNumber">2</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">3</strong>const {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">4</strong>    StyledComponent,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">5</strong>    Record,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">6</strong>    Router,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">7</strong>} = Torus;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">8</strong></pre></div>
<div class="line"><div class="doc"><p>When a user visits a /new editor, we need to populate it with blank versions of HTML and JS frames. We fetch them by identifying them with this fixed, precomputed hash of blank frames.</p>
</div><pre class="source javascript"><strong class="lineNumber">12</strong>const BLANK_HASH = 'e3b0c44298fc';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">13</strong></pre></div>
<div class="line"><div class="doc"><p>Utility function to fetch while bypassing the cache, and with some default options.</p>
</div><pre class="source javascript"><strong class="lineNumber">16</strong>const cfFetch = (uri, options) =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">17</strong>    return fetch(uri, {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">18</strong>        credentials: 'same-origin',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">19</strong>        cache: 'no-cache',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">20</strong>        ...options,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">21</strong>    });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">22</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">23</strong></pre></div>
<div class="line"><div class="doc"><p>This <code>api</code> object provides some utility methods we use to fetch and push stuff to and from the Codeframe internal API.</p>
</div><pre class="source javascript"><strong class="lineNumber">26</strong>const api = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">27</strong>    get: path =&#62; cfFetch(`/api${path}`, {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">28</strong>        method: 'GET',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">29</strong>    }),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">30</strong>    post: (path, body) =&#62; cfFetch(`/api${path}`, {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">31</strong>        method: 'POST',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">32</strong>        body: body,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">33</strong>    }),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">34</strong>    errlog: e =&#62; console.error(`Codeframe API error:\n\t${e}`),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">35</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">36</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">37</strong>const now = () =&#62; new Date().getTime();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">38</strong></pre></div>
<div class="line"><div class="doc"><p>Debounce coalesces multiple calls to the same function in a short period of time into one call, by cancelling subsequent calls within a given timeframe.</p>
</div><pre class="source javascript"><strong class="lineNumber">42</strong>const debounce = (fn, delayMillis) =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">43</strong>    let lastRun = 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">44</strong>    let to = null;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">45</strong>    return (...args) =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">46</strong>        clearTimeout(to);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">47</strong>        const dfn = () =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">48</strong>            lastRun = now();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">49</strong>            fn(...args);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">50</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">51</strong>        if (now() - lastRun &#62; delayMillis) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">52</strong>            dfn()</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">53</strong>        } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">54</strong>            to = setTimeout(dfn, delayMillis);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">55</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">56</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">57</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">58</strong></pre></div>
<div class="line"><div class="doc"><p>The <code>PreviewPane</code>  is the half-screen pane that shows a preview of the rendered Codeframe, alongside the URL and refresh buttons.</p>
</div><pre class="source javascript"><strong class="lineNumber">61</strong>class PreviewPane extends StyledComponent {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">62</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">63</strong>    init(frameRecord) {</pre></div>
<div class="line"><div class="doc"><p>Percentage of the editor size that the preview pane takes up.</p>
</div><pre class="source javascript"><strong class="lineNumber">65</strong>        this.paneWidth = 50;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">66</strong></pre></div>
<div class="line"><div class="doc"><p>We create an iframe manually and insert it into the component DOM, so as to avoid the iframe being re-fetched and re-rendered every time the preview pane is rendered.</p>
</div><pre class="source javascript"><strong class="lineNumber">70</strong>        this.iframe = document.createElement('iframe');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">71</strong>        this.iframe.setAttribute('frameborder', 0);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">72</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">73</strong>        this.bind(frameRecord, data =&#62; this.render(data));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">74</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">75</strong>        this.selectInput = this.selectInput.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">76</strong>        this.handleRefresh = this.handleRefresh.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">77</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">78</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">79</strong>    setWidth(width) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">80</strong>        this.paneWidth = width;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">81</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">82</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">83</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">84</strong>    styles() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">85</strong>        return css`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">86</strong>        display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">87</strong>        flex-direction: column;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">88</strong>        justify-content: space-between;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">89</strong>        align-items: flex-start;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">90</strong>        height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">91</strong>        flex-grow: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">92</strong>        flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">93</strong>        overflow: hidden;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">94</strong>        border-right: 2px solid var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">95</strong>        @media (max-width: 750px) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">96</strong>            width: 100% !important;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">97</strong>            height: 50% !important;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">98</strong>            border-right: 0 !important;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">99</strong>            border-bottom: 2px solid var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">100</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">101</strong>        .topBar {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">102</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">103</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">104</strong>            align-items: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">105</strong>            justify-content: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">106</strong>            width: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">107</strong>            padding: 0 3px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">108</strong>            border-bottom: 4px dotted var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">109</strong>            flex-shrink: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">110</strong>            height: 52px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">111</strong>            .embedded &#38; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">112</strong>                background: var(--cf-background);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">113</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">114</strong>            .inputContainer {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">115</strong>                box-sizing: content-box;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">116</strong>                flex-grow: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">117</strong>                flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">118</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">119</strong>            input {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">120</strong>                display: block;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">121</strong>                font-size: .75rem;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">122</strong>                font-weight: bold;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">123</strong>                height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">124</strong>                width: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">125</strong>                box-shadow: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">126</strong>                outline: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">127</strong>                border: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">128</strong>                padding: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">129</strong>                font-weight: normal;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">130</strong>                font-family: 'Menlo', 'Monaco', monospace;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">131</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">132</strong>            a {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">133</strong>                font-size: .75rem;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">134</strong>                flex-grow: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">135</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">136</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">137</strong>        iframe {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">138</strong>            height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">139</strong>            width: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">140</strong>            flex-grow: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">141</strong>            outline: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">142</strong>            border: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">143</strong>            box-shadow: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">144</strong>            flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">145</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">146</strong>        .refreshButton {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">147</strong>            font-size: 17px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">148</strong>            width: calc(.75rem + 17px);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">149</strong>            height: calc(.75rem + 17px);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">150</strong>            line-height: calc(.75rem + 18px);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">151</strong>            flex-shrink: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">152</strong>            padding: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">153</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">154</strong>            flex-direction: column;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">155</strong>            justify-content: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">156</strong>            align-items: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">157</strong>            &#38;:active {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">158</strong>                color: #000;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">159</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">160</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">161</strong>        .unsavedWarning {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">162</strong>            font-style: italic;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">163</strong>            white-space: nowrap;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">164</strong>            .button {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">165</strong>                font-style: initial;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">166</strong>                cursor: not-allowed;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">167</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">168</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">169</strong>        `;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">170</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">171</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">172</strong>    selectInput(evt) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">173</strong>        evt.target.select();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">174</strong>        gevent('preview', 'selecturl');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">175</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">176</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">177</strong>    handleRefresh() {</pre></div>
<div class="line"><div class="doc"><p>Force-refreshing the preview works by clearing the &quot;last url&quot; fetched, so it looks like the same URL is a new URL on next render.</p>
</div><pre class="source javascript"><strong class="lineNumber">180</strong>        this._lastURL = '';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">181</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">182</strong>        gevent('preview', 'refresh');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">183</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">184</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">185</strong>    safelySetIframeURL(url) {</pre></div>
<div class="line"><div class="doc"><p>If the iframe already has content, we want to replace its uri; if not, we want to give it a uri. This takes care of this logic.</p>
</div><pre class="source javascript"><strong class="lineNumber">188</strong>        if (this._lastURL !== url) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>If we simply assign to <code>iframe.src</code> property here, it adds an entry to the parent page&#39;s back/forward history, which we don&#39;t want. We only want to add to <code>src</code> if the iframe does not already have a page loaded (i.e. when <code>contentWindow</code> is null).</p>
</div><pre class="source javascript"><strong class="lineNumber">192</strong>            if (this.iframe.contentWindow) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">193</strong>                this.iframe.contentWindow.location.replace(url);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">194</strong>            } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">195</strong>                this.iframe.src = url;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">196</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">197</strong>            this._lastURL = url;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">198</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">199</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">200</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">201</strong>    compose(data) {</pre></div>
<div class="line"><div class="doc"><p>If we&#39;re not rendering from a saved Codeframe from the server but instead rendering a &quot;live&quot; preview, generate a data URI instead and point the iframe to that. Otherwise, just use the URL to the saved preview.</p>
</div><pre class="source javascript"><strong class="lineNumber">205</strong>        let url = '';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">206</strong>        if (data.liveRenderMarkup === null) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">207</strong>            url = `${window.location.origin}/f/${data.htmlFrameHash}/${data.jsFrameHash}.html`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">208</strong>        } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">209</strong>            url = 'data:text/html,' + encodeURIComponent(data.liveRenderMarkup);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">210</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">211</strong>        this.safelySetIframeURL(url);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">212</strong></pre></div>
<div class="line"><div class="doc"><p>We compare the new URL to the old URL here, to see whether we need to reset the <code>src</code> attribute on the iframe. If it&#39;s unchanged, we leave the iframe alone.</p>
</div><pre class="source javascript"><strong class="lineNumber">215</strong>        return jdom`&#60;div class="previewPanel" style="width:${this.paneWidth}%"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">216</strong>            ${data.liveRenderMarkup === null ? (</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">217</strong>                jdom`&#60;div class="topBar"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">218</strong>                    &#60;div class="fixed button inputContainer"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">219</strong>                        &#60;input value="${url}" onfocus="${this.selectInput}" /&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">220</strong>                    &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">221</strong>                    &#60;button class="button refreshButton" title="Refresh preview"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">222</strong>                        onclick="${this.handleRefresh}"&#62;&#8635;&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">223</strong>                    &#60;a class="button previewButton" title="Open preview in new tab"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">224</strong>                        target="_blank" href="${url}"&#62;Preview&#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">225</strong>                &#60;/div&#62;`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">226</strong>            ) : (</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">227</strong>                jdom`&#60;div class="topBar"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">228</strong>                    &#60;div class="unsavedWarning"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">229</strong>                        tap</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">230</strong>                        &#60;div class="fixed inline button"&#62;Save ${'&#38;'} Reload&#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">231</strong>                        to share &#60;span class="mobile-hidden"&#62;&#8594;&#60;/span&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">232</strong>                    &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">233</strong>                &#60;/div&#62;`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">234</strong>            )}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">235</strong>            ${this.iframe}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">236</strong>        &#60;/div&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">237</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">238</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">239</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">240</strong></pre></div>
<div class="line"><div class="doc"><p>The <code>Editor</code> component encapsulates the Monaco editor, all file state, and other state about the files the user is editing.</p>
</div><pre class="source javascript"><strong class="lineNumber">243</strong>class Editor extends StyledComponent {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">244</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">245</strong>    init(frameRecord) {</pre></div>
<div class="line"><div class="doc"><p>Percentage of the editor size that the editor pane takes up.</p>
</div><pre class="source javascript"><strong class="lineNumber">247</strong>        this.paneWidth = 50;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">248</strong></pre></div>
<div class="line"><div class="doc"><p>Initial values for extra settings</p>
</div><pre class="source javascript"><strong class="lineNumber">250</strong>        this.settings = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Is the config bar visible?</p>
</div><pre class="source javascript"><strong class="lineNumber">252</strong>            visible: false,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Is the as-you-type live reload enabled?</p>
</div><pre class="source javascript"><strong class="lineNumber">254</strong>            asYouTypeEnabled: true,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">255</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">256</strong></pre></div>
<div class="line"><div class="doc"><p>The &quot;mode&quot; is a slug, either <code>&#39;html&#39;</code> or <code>&#39;javascript&#39;</code>, that shows what file we&#39;re currently editing.</p>
</div><pre class="source javascript"><strong class="lineNumber">259</strong>        this.mode = 'html';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Frame hashes of the last-saved editor values, to see if we need to re-fetch frame file values when the route changes.</p>
</div><pre class="source javascript"><strong class="lineNumber">262</strong>        this._lastHash = '';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>The frames state stores the string contents of both files during editing.</p>
</div><pre class="source javascript"><strong class="lineNumber">264</strong>        this.frames = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">265</strong>            html: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">266</strong>            javascript: ``,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">267</strong>        }</pre></div>
<div class="line"><div class="doc"><p>Monaco has the concept of &quot;models&quot; to keep track of state across editing sessions between files. This is where we keep the model (state) of the two files, when they&#39;re not actively being edited. This preserves e.g. the undo/redo stack between mode switches.</p>
</div><pre class="source javascript"><strong class="lineNumber">271</strong>        this.models = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">272</strong>            html: null,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">273</strong>            javascript: null,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">274</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">275</strong>        this.initMonaco();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">276</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">277</strong>        this.bind(frameRecord, data =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">278</strong>            this.fetchFrames(data);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">279</strong>            this.render(data);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">280</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">281</strong></pre></div>
<div class="line"><div class="doc"><p>Any calls to <code>resizeEditor</code> should be debounced to 250ms. This is negligible to UX in fast modern laptops, but has a noticeable impact on UX for lower-end devices.</p>
</div><pre class="source javascript"><strong class="lineNumber">284</strong>        this.resizeEditor = debounce(this.resizeEditor.bind(this), 250);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">285</strong>        window.addEventListener('resize', this.resizeEditor);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">286</strong></pre></div>
<div class="line"><div class="doc"><p>We create these two methods that are versions of <code>switchMode</code> bound to specific editing modes, for easier use later on in <code>compose()</code>.</p>
</div><pre class="source javascript"><strong class="lineNumber">289</strong>        this.switchHTMLMode = this.switchMode.bind(this, 'html');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">290</strong>        this.switchJSMode = this.switchMode.bind(this, 'javascript');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">291</strong>        this.saveFrames = this.saveFrames.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">292</strong></pre></div>
<div class="line"><div class="doc"><p>Bind other methods used as callbacks</p>
</div><pre class="source javascript"><strong class="lineNumber">294</strong>        this.toggleSettings = this.toggleSettings.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">295</strong>        this.toggleAsYouType = this.toggleAsYouType.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">296</strong></pre></div>
<div class="line"><div class="doc"><p>Live-rendering (previewing unsaved changes) should be debounced, since we don&#39;t want to re-render the iframe with every keystroke, for example.</p>
</div><pre class="source javascript"><strong class="lineNumber">299</strong>        this.liveRenderFrames = debounce(this.liveRenderFrames.bind(this), 750);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">300</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">301</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">302</strong>    remove() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">303</strong>        window.removeEventListener('resize', this.resizeEditor)</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">304</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">305</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">306</strong>    setWidth(width) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">307</strong>        this.paneWidth = width;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">308</strong>        this.resizeEditor();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">309</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">310</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">311</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">312</strong>    fetchFrames(data) {</pre></div>
<div class="line"><div class="doc"><p><code>fetchFrames</code> is in charge of (1) determining based on new data whether we need to re-fetch HTML and JS files for the current version of the Codeframe (or if we have it already) and making those requests and saving the results to the view state. We are careful here to first check if the frames we are looking to fetch aren&#39;t the ones already saved in the editor.</p>
</div><pre class="source javascript"><strong class="lineNumber">317</strong>        if (</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">318</strong>            data.htmlFrameHash + data.jsFrameHash !== this._lastHash</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">319</strong>            &#38;&#38; data.htmlFrameHash</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">320</strong>        ) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">321</strong>            this._lastHash = data.htmlFrameHash + data.jsFrameHash;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">322</strong>            api.get(`/frame/${data.htmlFrameHash}`).then(resp =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">323</strong>                return resp.text();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">324</strong>            }).then(result =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">325</strong>                this.frames.html = result;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">326</strong>                if (this.models.html !== null) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">327</strong>                    this.models.html.setValue(result);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">328</strong>                }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">329</strong>            }).catch(e =&#62; api.errlog(e));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">330</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">331</strong>            api.get(`/frame/${data.jsFrameHash}`).then(resp =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">332</strong>                return resp.text();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">333</strong>            }).then(result =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">334</strong>                this.frames.javascript = result;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">335</strong>                if (this.models.javascript !== null) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">336</strong>                    this.models.javascript.setValue(result);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">337</strong>                }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">338</strong>            }).catch(e =&#62; api.errlog(e));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">339</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">340</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">341</strong></pre></div>
<div class="line"><div class="doc"><p><code>initMonaco</code> is one of the few places in the codebase that directly interacts with the Monaco editor&#39;s API. We create a new instance of an editor and start editing the currently selected mode&#39;s file.</p>
</div><pre class="source javascript"><strong class="lineNumber">345</strong>    initMonaco() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>We explicitly create a div to contain the editor, since that&#39;s how Monaco&#39;s editor API works.</p>
</div><pre class="source javascript"><strong class="lineNumber">348</strong>        this.monacoContainer = document.createElement('div');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">349</strong>        this.monacoContainer.classList.add('editorContainer');</pre></div>
<div class="line"><div class="doc"><p>Monaco&#39;s production bundle is designed to be consumed using an AMD module loader like RequireJS. You don&#39;t need to understand this part.</p>
</div><pre class="source javascript"><strong class="lineNumber">352</strong>        require.config({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">353</strong>            paths: {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">354</strong>                vs: 'https://unpkg.com/monaco-editor/min/vs',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">355</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">356</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">357</strong>        require(['vs/editor/editor.main'], () =&#62; {</pre></div>
<div class="line"><div class="doc"><p>Initialize models for both files</p>
</div><pre class="source javascript"><strong class="lineNumber">359</strong>            for (const lang of ['html', 'javascript']) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">360</strong>                this.models[lang] = monaco.editor.createModel(this.frames[lang], lang);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">361</strong>                this.models[lang].onDidChangeContent(this.liveRenderFrames);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">362</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">363</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">364</strong>            this.monacoEditor = monaco.editor.create(this.monacoContainer);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">365</strong>            this.monacoEditor.setModel(this.models[this.mode]);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">366</strong>            this.render();</pre></div>
<div class="line"><div class="doc"><p>After the editor renders once, we want to make sure the editor is sized correctly to the containing box. <code>layout()</code> forces Monaco to re-layout itself in the space it was given.</p>
</div><pre class="source javascript"><strong class="lineNumber">370</strong>            this.monacoEditor.layout();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">371</strong></pre></div>
<div class="line"><div class="doc"><p>Here we populate potential prefilled values from the URL query strings, and force-live-render it into the preview to make those dirty changes visible without saving these examples to the server.</p>
</div><pre class="source javascript"><strong class="lineNumber">375</strong>            if (prefilledValues.html || prefilledValues.js) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">376</strong>                this.frames.html = prefilledValues.html;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">377</strong>                this.models.html.setValue(prefilledValues.html);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">378</strong>                this.frames.javascript = prefilledValues.js;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">379</strong>                this.models.javascript.setValue(prefilledValues.js);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">380</strong>                this.liveRenderFrames({force: true});</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">381</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">382</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">383</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">384</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">385</strong>    resizeEditor() {</pre></div>
<div class="line"><div class="doc"><p><code>editorInstance.layout()</code> forces the editor to re-size itself.</p>
</div><pre class="source javascript"><strong class="lineNumber">387</strong>        if (this.monacoEditor) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">388</strong>            this.monacoEditor.layout();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">389</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">390</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">391</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">392</strong>    switchMode(mode) {</pre></div>
<div class="line"><div class="doc"><p>When we switch modes, we have to first save the value of the file being edited, then switch out the underlying file model.</p>
</div><pre class="source javascript"><strong class="lineNumber">395</strong>        if (this.monacoEditor) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">396</strong>            this.frames[this.mode] = this.monacoEditor.getValue();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">397</strong>            this.monacoEditor.setModel(this.models[mode]);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">398</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">399</strong>        this.mode = mode;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">400</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">401</strong>        gevent('editor', 'switchmode', mode);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">402</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">403</strong></pre></div>
<div class="line"><div class="doc"><p><code>liveRenderFrames()</code> is called when the editor content changes, to client-side refresh the iframe preview contents.</p>
</div><pre class="source javascript"><strong class="lineNumber">406</strong>    liveRenderFrames({force = false}) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">407</strong>        if (!this.settings.asYouTypeEnabled) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">408</strong>            return;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">409</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">410</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">411</strong>        const newEditorValue = this.monacoEditor.getValue();</pre></div>
<div class="line"><div class="doc"><p>No need to re-render changes when the editor value is not new. (In fact, because of leaky abstraction around events + immutable state between Monaco and Torus, doing so leads to a race bug.)</p>
</div><pre class="source javascript"><strong class="lineNumber">415</strong>        if (force || newEditorValue !== this.frames[this.mode]) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">416</strong>            this.frames[this.mode] = newEditorValue;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">417</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">418</strong>            const documentMarkup = `&#60;!DOCTYPE html&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">419</strong>&#60;html&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">420</strong>    &#60;head&#62;&#60;title&#62;Live Frame | CodeFrame&#60;/title&#62;&#60;/head&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">421</strong>    &#60;body&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">422</strong>        ${this.frames.html}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">423</strong>        &#60;script src="https://unpkg.com/torus-dom/dist/index.min.js"&#62;&#60;/script&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">424</strong>        &#60;script&#62;${this.frames.javascript}&#60;/script&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">425</strong>    &#60;/body&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">426</strong>&#60;/html&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">427</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">428</strong>            this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">429</strong>                liveRenderMarkup: documentMarkup,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">430</strong>            });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">431</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">432</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">433</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">434</strong>    toggleSettings() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">435</strong>        this.settings.visible = !this.settings.visible;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">436</strong>        this.render();</pre></div>
<div class="line"><div class="doc"><p>The settings bar changes the editor view size, so we need to re-layout the editor after render.</p>
</div><pre class="source javascript"><strong class="lineNumber">439</strong>        this.resizeEditor();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">440</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">441</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">442</strong>    toggleAsYouType() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">443</strong>        this.settings.asYouTypeEnabled = !this.settings.asYouTypeEnabled;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">444</strong>        this.render();</pre></div>
<div class="line"><div class="doc"><p>In case there are any current dirty changes when this is toggled on...</p>
</div><pre class="source javascript"><strong class="lineNumber">446</strong>        if (this.settings.asYouTypeEnabled) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">447</strong>            this.liveRenderFrames();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">448</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">449</strong>        gevent('editor', 'settings.asyoutype', this.settings.asYouTypeEnabled.toString());</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">450</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">451</strong></pre></div>
<div class="line"><div class="doc"><p><code>saveFrames</code> handles saving / persisting Codeframe files to the backend service, and returns a promise that resolves only once all frame files have been saved.</p>
</div><pre class="source javascript"><strong class="lineNumber">454</strong>    async saveFrames() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">455</strong>        this.frames[this.mode] = this.monacoEditor.getValue();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">456</strong>        const hashes = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">457</strong>            html: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">458</strong>            js: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">459</strong>        }</pre></div>
<div class="line"><div class="doc"><p>This is a nice way to make the function hang (not resolve its returned Promise) until all of its requests have resolved.</p>
</div><pre class="source javascript"><strong class="lineNumber">462</strong>        await Promise.all([</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">463</strong>            api.post('/frame/', this.frames.html)</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">464</strong>                .then(resp =&#62; resp.text())</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">465</strong>                .then(hash =&#62; hashes.html = hash)</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">466</strong>                .catch(e =&#62; api.errlog(e)),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">467</strong>            api.post('/frame/', this.frames.javascript)</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">468</strong>                .then(resp =&#62; resp.text())</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">469</strong>                .then(hash =&#62; hashes.js = hash)</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">470</strong>                .catch(e =&#62; api.errlog(e)),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">471</strong>        ]);</pre></div>
<div class="line"><div class="doc"><p>Once we&#39;ve saved the current frames, open the new frames up in the preview pane by going to this route with the new frames.</p>
</div><pre class="source javascript"><strong class="lineNumber">474</strong>        router.go(`/h/${hashes.html}/j/${hashes.js}/edit`);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">475</strong>        gevent('editor', 'save');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">476</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">477</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">478</strong>    styles() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">479</strong>        return css`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">480</strong>        height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">481</strong>        flex-grow: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">482</strong>        flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">483</strong>        overflow: hidden;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">484</strong>        border-left: 2px solid var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">485</strong>        display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">486</strong>        flex-direction: column;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">487</strong>        @media (max-width: 750px) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">488</strong>            width: 100% !important;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">489</strong>            height: 50% !important;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">490</strong>            border-left: 0 !important;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">491</strong>            border-top: 2px solid var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">492</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">493</strong>        .topBar {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">494</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">495</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">496</strong>            justify-content: space-between;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">497</strong>            align-items: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">498</strong>            padding: 0 3px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">499</strong>            border-bottom: 4px dotted var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">500</strong>            flex-shrink: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">501</strong>            height: 52px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">502</strong>            overflow-x: auto;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">503</strong>            .embedded &#38; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">504</strong>                background: var(--cf-background);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">505</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">506</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">507</strong>        .buttonGroup {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">508</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">509</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">510</strong>            align-items: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">511</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">512</strong>        .button {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">513</strong>            font-size: .75rem;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">514</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">515</strong>        .editorContainer .button {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">516</strong>            border: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">517</strong>            background: transparent;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">518</strong>            height: unset;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">519</strong>            width: unset;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">520</strong>            &#38;::before,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">521</strong>            &#38;::after {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">522</strong>                display: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">523</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">524</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">525</strong>        .editorContainer,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">526</strong>        .ready {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">527</strong>            width: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">528</strong>            flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">529</strong>            flex-grow: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">530</strong>            overflow: hidden;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">531</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">532</strong>        .ready {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">533</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">534</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">535</strong>            justify-content: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">536</strong>            align-items: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">537</strong>            color: #555;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">538</strong>            em {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">539</strong>                display: block;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">540</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">541</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">542</strong>        `;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">543</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">544</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">545</strong>    compose() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">546</strong>        return jdom`&#60;div class="editor" style="width:${this.paneWidth}%"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">547</strong>            &#60;div class="topBar"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">548</strong>                &#60;div class="buttonGroup"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">549</strong>                    &#60;button</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">550</strong>                        class="button ${this.mode === 'html' ? 'active' : ''} tab-html"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">551</strong>                        title="Switch to HTML editor"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">552</strong>                        onclick="${this.switchHTMLMode}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">553</strong>                        HTML</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">554</strong>                    &#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">555</strong>                    &#60;button</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">556</strong>                        class="button ${this.mode === 'javascript' ? 'active' : ''} tab-js"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">557</strong>                        title="Switch to JavaScript editor"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">558</strong>                        onclick="${this.switchJSMode}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">559</strong>                        JavaScript</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">560</strong>                    &#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">561</strong>                &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">562</strong>                &#60;div class="buttonGroup"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">563</strong>                    &#60;button class="button ${this.settings.visible ? 'active' : ''}" title="Show additional settings"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">564</strong>                        onclick="${this.toggleSettings}"&#62;...&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">565</strong>                    &#60;button class="button" title="Save Codeframe and reload preview"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">566</strong>                        onclick="${this.saveFrames}"&#62;Save ${'&#38;'} Reload&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">567</strong>                &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">568</strong>            &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">569</strong>            ${this.settings.visible ? (</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">570</strong>                jdom`&#60;div class="topBar"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">571</strong>                    &#60;button class="button ${this.settings.asYouTypeEnabled ? 'active' : ''}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">572</strong>                        title="Turn on or off live-reloading as you type"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">573</strong>                        onclick="${this.toggleAsYouType}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">574</strong>                        Reload as you type</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">575</strong>                        ${this.settings.asYouTypeEnabled ? '(on)' : '(off)'}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">576</strong>                    &#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">577</strong>                &#60;/div&#62;`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">578</strong>            ) : null}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">579</strong>            ${this.monacoEditor ? this.monacoContainer : (</pre></div>
<div class="line"><div class="doc"><p>If the editor is not yet available (is still loading), show a placeholder bit of text.</p>
</div><pre class="source javascript"><strong class="lineNumber">582</strong>                jdom`&#60;div class="ready"&#62;&#60;em&#62;Getting your editor ready...&#60;/em&#62;&#60;/div&#62;`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">583</strong>            )}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">584</strong>        &#60;/div&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">585</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">586</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">587</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">588</strong></pre></div>
<div class="line"><div class="doc"><p>The <code>Workspace</code> component is the &quot;Codeframe editor&quot;. That is to say, this is the component that wraps everything into a neat, interactive page and is the backbone of the Codeframe editing experience.</p>
</div><pre class="source javascript"><strong class="lineNumber">592</strong>class Workspace extends StyledComponent {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">593</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">594</strong>    init(frameRecord) {</pre></div>
<div class="line"><div class="doc"><p>The left/right panes are split 50/50 between its two panes.</p>
</div><pre class="source javascript"><strong class="lineNumber">596</strong>        this.paneSplit = 50;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">597</strong>        this.preview = new PreviewPane(frameRecord);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">598</strong>        this.editor = new Editor(frameRecord);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">599</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">600</strong>        this.bind(frameRecord, data =&#62; this.render(data));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">601</strong></pre></div>
<div class="line"><div class="doc"><p><code>this.grabDragging</code> represents whether there is currently a drag-to-resize-panes interaction happening.</p>
</div><pre class="source javascript"><strong class="lineNumber">604</strong>        this.grabDragging = false;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">605</strong>        this.handleGrabMousedown = this.handleGrabMousedown.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">606</strong>        this.handleGrabMousemove = this.handleGrabMousemove.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">607</strong>        this.handleGrabMouseup = this.handleGrabMouseup.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">608</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">609</strong></pre></div>
<div class="line"><div class="doc"><p>Shortcut method to set the sizes of children components, given one split percentage.</p>
</div><pre class="source javascript"><strong class="lineNumber">612</strong>    setPaneWidth(width) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>These cases implement &quot;snapping&quot; of panes to 0, 50, 100% increments, with 1% buffer around each snap point.</p>
</div><pre class="source javascript"><strong class="lineNumber">615</strong>        if (width &#60; 1) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">616</strong>            width = 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">617</strong>        } else if (width &#62; 99) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">618</strong>            width = 100;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">619</strong>        } else if (width &#62; 49 &#38;&#38; width &#60; 51) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">620</strong>            width = 50;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">621</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">622</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">623</strong>        this.paneSplit = width;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">624</strong>        this.preview.setWidth(width);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">625</strong>        this.editor.setWidth(100 - width);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">626</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">627</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">628</strong></pre></div>
<div class="line"><div class="doc"><p>What follows are mouse/pointer event handlers to make resizing a smooth experience.</p>
</div><pre class="source javascript"><strong class="lineNumber">631</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">632</strong>    handleGrabMousedown() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">633</strong>        this.grabDragging = true;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">634</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">635</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">636</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">637</strong>    handleGrabMousemove(evt) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">638</strong>        if (this.grabDragging) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">639</strong>            if (!evt.defaultPrevented) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">640</strong>                evt.preventDefault();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">641</strong>            }</pre></div>
<div class="line"><div class="doc"><p>If the event is a touch event, get the <code>clientX</code> of the first touch point, not the whole event.</p>
</div><pre class="source javascript"><strong class="lineNumber">644</strong>            if (evt.touches) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">645</strong>                evt = evt.touches[0];</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">646</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">647</strong>            this.setPaneWidth(evt.clientX / window.innerWidth * 100);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">648</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">649</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">650</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">651</strong>    handleGrabMouseup() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">652</strong>        this.grabDragging = false;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">653</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">654</strong>        gevent('workspace', 'resize', 'editor', this.paneSplit);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">655</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">656</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">657</strong>    styles() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">658</strong>        return css`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">659</strong>        width: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">660</strong>        height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">661</strong>        display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">662</strong>        flex-direction: column;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">663</strong>        header {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">664</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">665</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">666</strong>            justify-content: space-between;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">667</strong>            align-items: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">668</strong>            flex-shrink: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">669</strong>            padding: 4px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">670</strong>            background: var(--cf-background);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">671</strong>            border-bottom: 4px solid var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">672</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">673</strong>        &#38;.embedded header {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">674</strong>            display: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">675</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">676</strong>        nav {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">677</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">678</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">679</strong>            flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">680</strong>            overflow-x: auto;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">681</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">682</strong>        main {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">683</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">684</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">685</strong>            justify-content: space-between;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">686</strong>            align-items: flex-start;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">687</strong>            flex-grow: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">688</strong>            flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">689</strong>            overflow: hidden;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">690</strong>            position: relative;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">691</strong>            height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">692</strong>            @media (max-width: 750px) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">693</strong>                flex-direction: column !important;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">694</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">695</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">696</strong>        .button {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">697</strong>            white-space: nowrap;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">698</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">699</strong>        .newButton {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">700</strong>            color: var(--cf-accent);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">701</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">702</strong>        .grabHandle {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">703</strong>            position: absolute;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">704</strong>            top: 50%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">705</strong>            left: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">706</strong>            transform: translate(-50%, -50%);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">707</strong>            border-radius: 4px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">708</strong>            width: 8px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">709</strong>            height: 56px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">710</strong>            background: #fff;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">711</strong>            border: 3px solid var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">712</strong>            cursor: ew-resize;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">713</strong>            z-index: 2000;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">714</strong>            &#38;:hover {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">715</strong>                background: var(--cf-background);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">716</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">717</strong>            &#38;:active {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">718</strong>                background: var(--cf-accent);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">719</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">720</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">721</strong>        .grabHandleShadow {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">722</strong>            background: rgba(0, 0, 0, .1);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">723</strong>            position: absolute;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">724</strong>            top: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">725</strong>            left: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">726</strong>            right: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">727</strong>            bottom: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">728</strong>            z-index: 1000;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">729</strong>            transition: opacity .3s;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">730</strong>            &#38;.hidden {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">731</strong>                opacity: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">732</strong>                pointer-events: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">733</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">734</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">735</strong>        .fullButton {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">736</strong>            display: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">737</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">738</strong>        &#38;.embedded .fullButton {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">739</strong>            display: block;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">740</strong>            position: absolute;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">741</strong>            top: unset;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">742</strong>            left: unset;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">743</strong>            bottom: 2px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">744</strong>            right: 6px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">745</strong>            font-size: .75em;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">746</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">747</strong>        `;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">748</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">749</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">750</strong>    compose() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">751</strong>        return jdom`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">752</strong>        &#60;div class="workspace ${window.frameElement === null ? '' : 'embedded'}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">753</strong>            ontouchmove="${this.grabDragging ? this.handleGrabMousemove : ''}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">754</strong>            ontouchend="${this.grabDragging ? this.handleGrabMouseup : ''}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">755</strong>            onmousemove="${this.grabDragging ? this.handleGrabMousemove : ''}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">756</strong>            onmouseup="${this.grabDragging ? this.handleGrabMouseup : ''}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">757</strong>            &#60;header&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">758</strong>                &#60;div class="logo"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">759</strong>                    &#60;a class="button" href="/"&#62;Codeframe&#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">760</strong>                &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">761</strong>                &#60;nav&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">762</strong>                    &#60;a class="button newButton" href="/new?from=editor"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">763</strong>                        + New &#60;span class="mobile-hidden"&#62;Codeframe&#60;/span&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">764</strong>                    &#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">765</strong>                    &#60;a class="button tiny-hidden" href="https://twitter.com/thesephist" target="_blank"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">766</strong>                        &#60;span class="mobile-hidden"&#62;Made by&#60;/span&#62; @thesephist</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">767</strong>                    &#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">768</strong>                    &#60;a class="button" href="https://github.com/thesephist/codeframe" target="_blank"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">769</strong>                        &#60;span class="mobile-hidden"&#62;View Source on&#60;/span&#62; GitHub</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">770</strong>                    &#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">771</strong>                &#60;/nav&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">772</strong>            &#60;/header&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">773</strong>            &#60;main&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">774</strong>                ${this.preview.node}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">775</strong>                ${this.editor.node}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">776</strong>                &#60;a class="button fullButton"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">777</strong>                    title="Open this editor in a new tab"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">778</strong>                    target="_blank"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">779</strong>                    href="${window.location.href}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">780</strong>                    Open in new tab</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">781</strong>                &#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">782</strong>                &#60;div class="grabHandleShadow ${this.grabDragging ? '' : 'hidden'}"&#62;&#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">783</strong>                &#60;div</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">784</strong>                    title="Resize editor panes"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">785</strong>                    class="grabHandle mobile-hidden"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">786</strong>                    style="left:${this.paneSplit}%"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">787</strong>                    ontouchstart="${this.handleGrabMousedown}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">788</strong>                    onmousedown="${this.handleGrabMousedown}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">789</strong>                &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">790</strong>            &#60;/main&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">791</strong>        &#60;/div&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">792</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">793</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">794</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">795</strong></pre></div>
<div class="line"><div class="doc"><p>The <code>App</code> component simply wraps around the <code>Workspace</code> to provide routing and a container for the workspace.</p>
</div><pre class="source javascript"><strong class="lineNumber">798</strong>class App extends StyledComponent {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">799</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">800</strong>    init(router) {</pre></div>
<div class="line"><div class="doc"><p>This <code>frameRecord</code> becomes the view model for most views in the editor.</p>
</div><pre class="source javascript"><strong class="lineNumber">803</strong>        this.frameRecord = new Record({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">804</strong>            htmlFrameHash: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">805</strong>            jsFrameHash: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">806</strong>            liveRenderMarkup: null,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">807</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">808</strong>        this.workspace = new Workspace(this.frameRecord);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">809</strong></pre></div>
<div class="line"><div class="doc"><p>Routing logic.</p>
</div><pre class="source javascript"><strong class="lineNumber">811</strong>        this.bind(router, ([name, params]) =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">812</strong>            switch (name) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">813</strong>                case 'edit':</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">814</strong>                    this.frameRecord.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">815</strong>                        htmlFrameHash: params.htmlFrameHash,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">816</strong>                        jsFrameHash: params.jsFrameHash,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">817</strong>                        liveRenderMarkup: null,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">818</strong>                    });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">819</strong>                    break;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">820</strong>                default:</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">821</strong>                    {</pre></div>
<div class="line"><div class="doc"><p>If there are prefilled HTML and JavaScript values provided provided in the query string, parse and save it for later when the editor loads.</p>
</div><pre class="source javascript"><strong class="lineNumber">825</strong>                        const searchPart = window.location.search.substr(1);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">826</strong>                        if (searchPart) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">827</strong>                            for (const pair of searchPart.split('&#38;')) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">828</strong>                                const idx = pair.indexOf('=');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">829</strong>                                const langPart = pair.substr(0, idx);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">830</strong>                                if (langPart in prefilledValues) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">831</strong>                                    prefilledValues[langPart] = decodeURIComponent(pair.substr(idx + 1));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">832</strong>                                }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">833</strong>                            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">834</strong>                        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">835</strong>                    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">836</strong>                    router.go(`/h/${BLANK_HASH}/j/${BLANK_HASH}/edit`);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">837</strong>                    break;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">838</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">839</strong>        })</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">840</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">841</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">842</strong>    styles() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">843</strong>        return css`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">844</strong>        width: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">845</strong>        height: 100vh;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">846</strong>        display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">847</strong>        flex-direction: column;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">848</strong>        overflow: hidden;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">849</strong>        `;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">850</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">851</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">852</strong>    compose() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">853</strong>        return jdom`&#60;div id="root"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">854</strong>            ${this.workspace.node}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">855</strong>        &#60;/div&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">856</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">857</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">858</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">859</strong></pre></div>
<div class="line"><div class="doc"><p>Used to save some global values for when the URL contains a pre-populated code sample.</p>
</div><pre class="source javascript"><strong class="lineNumber">862</strong>const prefilledValues = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">863</strong>    html: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">864</strong>    js: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">865</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">866</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">867</strong>const router = new Router({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">868</strong>    edit: '/h/:htmlFrameHash/j/:jsFrameHash/edit',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">869</strong>    default: '/new',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">870</strong>});</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">871</strong></pre></div>
<div class="line"><div class="doc"><p>Create a new instance of the editor app and mount it to the DOM.</p>
</div><pre class="source javascript"><strong class="lineNumber">873</strong>const app = new App(router);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">874</strong>document.body.appendChild(app.node);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">875</strong></pre></div>
<div class="line"><div class="doc"><p>Since the editor is a full-window app, we don&#39;t want any overflows to make the app unnecessary scrollable beyond its viewport.</p>
</div><pre class="source javascript"><strong class="lineNumber">878</strong>document.body.style.overflow = 'hidden';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">879</strong></pre></div>
    </main>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github-gist.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>
        for (const el of document.querySelectorAll('.line pre')) {
            hljs.highlightBlock(el);
        }
    </script>
</body>

</html>